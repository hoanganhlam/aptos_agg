<template>
  <div class="bg-[#F1F1F1]">
    <div
        class="h-full flex flex-col items-center justify-center space-y-3 text-white bg-[url('/header-page.png')] bg-cover bg-center">
        <div class="w-full h-full py-20 flex flex-col justify-center items-center backdrop-blur-md backdrop-brightness-50">
          <svg width="485" height="38" viewBox="0 0 485 38" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M31.6711 28.692C31.6711 30.772 29.9031 32.54 27.8231 32.54H0.0550782V38H27.8231C32.1911 38 34.3231 35.4 37.1311 32.54V25.832C37.1311 20.632 32.8671 16.992 27.8231 16.992H9.36308C7.43908 16.992 5.82708 15.484 5.56708 13.612H0.0550782C0.471078 18.552 4.31908 22.452 9.36308 22.452H27.8231C29.8511 22.452 31.6711 23.648 31.6711 25.832V28.692ZM9.36308 0.975999C4.16308 0.975999 0.211078 5.136 0.0550782 10.284H5.51508C5.56708 8.204 7.23108 6.436 9.36308 6.436H37.1311V0.975999H9.36308ZM72.6199 16.992H66.6919L60.9199 30.512L48.2839 0.975999H42.3559L58.1639 38H63.6239L72.6199 16.992ZM74.5959 26.144L71.5799 33.112L73.7119 38H79.1719L94.9799 0.975999H89.0519L76.4159 30.512L74.5959 26.144ZM136.764 32.54H105.148V22.452H131.304V16.992H99.6879V38H136.764V32.54ZM136.816 0.975999H99.6879V6.436H136.816V0.975999ZM179.115 32.54H147.499V22.452H173.655V16.992H142.039V38H179.115V32.54ZM179.167 0.975999H142.039V6.436H179.167V0.975999ZM221.467 10.284C221.467 5.136 217.307 0.975999 212.159 0.975999H184.391V6.436H212.159C215.747 6.436 216.007 9.348 216.007 11.22C216.007 14.652 215.071 16.992 212.159 16.992H184.391V38H189.851V22.452H212.159C217.307 22.452 221.467 18.292 221.467 13.144V10.284ZM263.56 10.284C263.56 7.216 266.628 6.384 269.124 6.384C270.32 6.384 272.14 6.436 273.96 6.436V0.975999H266.68C261.688 0.975999 258.152 5.552 258.152 10.284V12.884C258.152 14.496 258.568 16.056 259.192 17.512C255.552 18.864 252.692 22.296 252.692 26.3V28.692C252.692 33.84 256.852 38 262 38H280.772C281.968 38 283.164 37.688 284.256 37.22V38H289.768V22.4H284.308C284.308 24.688 284.412 27.08 284.36 28.224C284.152 30.98 282.228 32.54 280.668 32.54H262C259.92 32.54 258.152 30.772 258.152 28.692V26.3C258.152 24.376 259.764 22.4 261.792 22.4H273.96V16.992H267.408C265.224 16.992 263.56 14.964 263.56 12.884V10.284ZM352.609 28.692C352.609 30.772 350.841 32.54 348.761 32.54H320.993V38H348.761C353.129 38 355.261 35.4 358.069 32.54V25.832C358.069 20.632 353.805 16.992 348.761 16.992H330.301C328.377 16.992 326.765 15.484 326.505 13.612H320.993C321.409 18.552 325.257 22.452 330.301 22.452H348.761C350.789 22.452 352.609 23.648 352.609 25.832V28.692ZM330.301 0.975999C325.101 0.975999 321.149 5.136 320.993 10.284H326.453C326.505 8.204 328.169 6.436 330.301 6.436H358.069V0.975999H330.301ZM397.353 30.512L392.569 19.28L400.369 0.975999H394.441L389.605 12.312L384.769 0.975999H378.841L386.641 19.28L381.857 30.512L369.221 0.975999H363.293L379.101 38H384.561L389.605 26.196L394.649 38H400.109L415.917 0.975999H409.989L397.353 30.512ZM416.659 27.08H432.571L437.199 38H443.127L427.319 0.975999H421.859L406.051 38H411.979L416.659 27.08ZM418.635 22.4L424.615 8.464L430.543 22.4H418.635ZM484.92 10.284C484.92 5.136 480.76 0.975999 475.612 0.975999H447.844V38H453.304V22.452H475.612C480.76 22.452 484.92 18.292 484.92 13.144V10.284ZM475.612 6.436C477.744 6.436 479.46 8.152 479.46 10.284V13.144C479.46 15.224 477.692 16.992 475.612 16.992H453.304V6.436H475.612Z" fill="white"/>
</svg>
<p class="pt-5">The most robust and fastest NFT aggregator on multi-chain</p>
        </div>
      <!-- <h1 class="text-6xl font-['Netron']">
        

      </h1> -->

    </div>
    <div class="px-4 max-w-6xl mx-auto">
      <div class="py-16 space-y-4">
        <div class="flex items-center gap-2 text-[#0E224A] text-lg font-bold">
          <img src="/icon-later.png" class="w-4 h-4" alt="">
          <span>The latest NFT collections</span>
        </div>
        <div class="max-w-6xl mx-auto grid md:grid-cols-3 gap-6">
          <div class="bg-white p-4 rounded-lg" v-for="i in 3" :key="i">
            <div class="flex gap-4">
              <div class="flex-1">
                <img class="w-full" src="/s4/1.png" alt="">
              </div>
              <div class="w-1/4 space-y-4">
                <div v-for="i in 3" :key="i">
                  <img class="w-full" src="/s4/2.png" alt="">
                </div>
              </div>
            </div>
            <h4 class="mt-6 mb-4 font-bold text-lg">Amazing Collection</h4>
            <div class="flex gap-3">
              <div class="w-8 h-8">
                <img src="/avatar.png" alt="">
              </div>
              <div class="flex-1">
                <p>by Arkhan</p>
              </div>
              <div>
                <div
                    class="flex px-6 py-2 rounded-full border border-[#2D398D] text-[#2D398D] duration-200 cursor-pointer">
                  Total 54 Items
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pb-16 space-y-4">
        <div class="flex justify-between">
          <div class="flex gap-4">
            <div class="rounded-full cursor-pointer py-2 px-6 bg-[#E17A2D] text-white font-semibold w-32 text-bold">
              Trending
            </div>
          </div>
          <div class="flex gap-4 text-[#111827]">
            <div
                v-for="item in dateRanges" :key="item"
                class="rounded-full bg-[#DCDCDC] cursor-pointer py-2 px-4 font-semibold text-bold flex justify-center gap-2"
            >
              <span>{{ item }}</span>
            </div>
            <div
                class="rounded-full bg-[#DCDCDC] cursor-pointer py-2 px-4 font-semibold text-bold flex justify-center gap-2"
            >
              <icon name="refresh"></icon>
            </div>
          </div>
        </div>
        <div class="mt-8 flex flex-col">
          <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
            <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
              <table class="min-w-full divide-y divide-gray-300">
                <thead>
                <tr>
                  <th scope="col"
                      class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6 md:pl-0">Collection
                  </th>
                  <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold text-gray-900">24h volume</th>
                  <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold text-gray-900">Total Volume</th>
                  <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold text-gray-900">Floor Price</th>
                  <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold text-gray-900">Owners</th>
                  <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6 md:pr-0">Supply</th>
                </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                <tr v-for="(item,index) in querySet" :key="item.collection_id">
                  <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 md:pl-0">
                    <div class="flex gap-3 items-center">
                      <div class="w-8 h-8">
                        <img v-if="item.logo_uri" :src="item.logo_uri" alt="">
                      </div>
                      <nuxt-link :to="`/collection/${item.collection_id}`">{{ item.name }}</nuxt-link>
                    </div>
                  </td>
                  <td class="whitespace-nowrap py-4 px-3 text-sm text-gray-500 flex gap-2 items-center">
                    <img src="/apt-icon.png" class="w-4 h-4" alt="">
                    <span>{{ priceWei(item.volume_24) }}</span>
                  </td>
                  <td class="whitespace-nowrap py-4 px-3 text-sm text-[#00AC4F]">{{ priceWei(item.total_volume) }}</td>
                  <td class="whitespace-nowrap py-4 px-3 text-sm text-gray-500 flex gap-2 items-center">
                    <img src="/apt-icon.png" class="w-4 h-4" alt="">
                    <span>{{ priceWei(item.floor) }}</span>
                  </td>
                  <td class="whitespace-nowrap py-4 px-3 text-sm text-gray-500">{{
                      pretty_num(item.num_unique_owners)
                    }}
                  </td>
                  <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 md:pr-0">
                    {{ pretty_num(item.num_tokens) }}
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: "DiscoveryPage",
  data() {
    return {
      dateRanges: ["24h", "1d", "30D"],
      querySet: [],
      ipfs_gateway: ['https://ipfs.io/ipfs/', 'https://dweb.link/ipfs/', 'https://cloudflare-ipfs.com/ipfs/', 'https://gateway.pinata.cloud/ipfs/', 'https://gateway.ipfs.io/ipfs/']
    }
  },
  async fetch() {

    const pretty_url = (url) => {
      if (!url) return '_'
      const ipfs_gw = this.ipfs_gateway[Math.floor(Math.random() * this.ipfs_gateway.length)];
      return url.replace('ipfs://', ipfs_gw).replace('https://nftstorage.link/ipfs/', ipfs_gw)
    }

    const collection_set = await this.$axios.$get('https://gemmerge.pvnt.repl.co/getCollections').then(res => res.data)
    this.querySet = collection_set;
    const res = await Promise.allSettled(
        collection_set.map(x => {
          return this.$axios.$get(pretty_url(x.uri), {timeout: 3000})
        })
    )

    this.querySet = collection_set.map((x, i) => {
      if (!res[i].reason && !x.logo_uri) {
        x.logo_uri = pretty_url(res[i].value.image)
      }
      return x
    })
  },
  methods: {
    priceWei(str) {
      return str ? Number.parseFloat((Number.parseInt(str) / Math.pow(10, 8)).toFixed(4)).toLocaleString() : "_"
    },
    pretty_num(num) {
      return num ? num.toLocaleString() : "_"
    }
  }
}
</script>

<style scoped>

</style>
